<!DOCTYPE html>
<html lang="en">
<head>
  <title>Railway Track Health Visualization</title>
  <style>
    body { margin: 0; overflow: hidden; }
  </style>
</head>
<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.module.js"
  }
}
</script>
<body>

<script type="module">
  import * as THREE from "three";
  import { GLTFLoader } from "https://cdn.jsdelivr.net/npm/three@0.155.0/examples/jsm/loaders/GLTFLoader.js";

  // Scene
  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0xf0f0f0);

  const camera = new THREE.PerspectiveCamera(
    75, window.innerWidth / window.innerHeight, 0.1, 1000
  );
  camera.position.set(0, 4, 10);

  const renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  const light = new THREE.DirectionalLight(0xffffff, 1);
  light.position.set(10, 10, 10);
  scene.add(light);

  // Load GLB
    let trackModel = null;

    const loader = new GLTFLoader();
    loader.load(
    "./models/railway_track.glb",
    (gltf) => {
        trackModel = gltf.scene;
        trackModel.scale.set(1.5, 1.5, 1.5);
        trackModel.position.set(0, 0, 0);
        scene.add(trackModel);
    },
    undefined,
    (error) => console.error(error)
    );
  function priorityColor(p) {
    if (p === 1) return 0x00ff00;
    if (p === 2) return 0xffff00;
    if (p === 3) return 0xffa500;
    return 0xff0000;
  }

  async function loadData() {
    const res = await fetch("http://127.0.0.1:8000/assess/network", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        segments: [
          { segment_id: 1, features: [0.32, 1.8, 28.5, 1.01, 420] },
          { segment_id: 2, features: [0.48, 3.9, 52.2, 0.97, 610] },
          { segment_id: 3, features: [0.71, 6.4, 78.1, 1.08, 890] }
        ]
      })
    });

    const data = await res.json();

    data.segments.forEach((seg, i) => {
      const geo = new THREE.BoxGeometry(2.2, 0.05, 1.2);
      const mat = new THREE.MeshStandardMaterial({
        color: priorityColor(seg.priority),
        transparent: true,
        opacity: 0.6
      });
      const overlay = new THREE.Mesh(geo, mat);
      const spacing = 2.5;
        const total = data.segments.length;

        overlay.position.set(
        0,
        0.05,
        (i - (total - 1) / 2) * spacing
        );
      trackModel.add(overlay);
    });
  }

  loadData();

  function animate() {
    requestAnimationFrame(animate);
    renderer.render(scene, camera);
  }
  animate();
</script>


</body>
</html>
